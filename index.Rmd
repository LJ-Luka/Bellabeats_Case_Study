---
title: 'Capstone Case Study: Bellabeats'
author: "Lumi Luka"
date: "2022-12-29"
output:
  html_document: default
  word_document: default
  pdf_document: default
---



## Summary

Founded in 2013 by Urska Srsen and Sando Mur, Bellabeats is a tech-driven health and wellness company that manufactures smart products to enable women to track their health and habits based on their activity, stress, sleep and reproductive health.
Srsen, the Chief Creative officer, knows that growth opportunities would be revealed from an analysis of Bellabeat's customer data. She wants the marketing analytics team, in which I am a junior data analyst to analyse usage data of non-Bellabeat smart devices while focusing on a Bellabeat product. The purpose is to gain insights into how those other devices are being used by customers and apply the insights to the Bellabeat product.


**Problem statement:**  
To analyse smart device usage data to gain insights into how consumers use smart devices and apply these insights to a Bellabeat product

**Goals/metrics:**  
To use insights to reveal growth opportunities  

**Deliverables:**    
*	Write a clear summary of the business task  
*	A description of all data sources used  
*	Documentation of any cleaning or manipulation of data  
*	Write a summary of the analysis  
*	Present supporting visualisation and key findings  
*	Make a high-level recommendation based on the analysis  

**Website to scrape the needed data:** Click [here](https://www.kaggle.com/datasets/arashnic/fitbit)  

The case study road map follows the data analytics process, Ask, Prepare, Process, Analyse, Share.  


### Ask    

The problem here is finding trends in smart device usage. Any insights gained will come from trends or patterns noticed in the data. This will drive business decisions. The SMART reference was used while asking questions. This ensures that the questions asked are Specific, Measurable, Action-oriented, Relevant and Time-bound.

**Key tasks:**  
*	Identify the business task: The task is to gain insights into how consumers use non-Bellabeat smart devices and apply those insights to a Bellabeat product to help guide marketing strategy for the company  
*	Consider key stakeholders: The key stakeholders are Urska Srsen, Sando Mur, the Bellabeat marketing analytics team and the Bellabeat customers.

**Deliverable:**
A clear statement of the business task  


### Prepare  

Of the 18 .csv files from the available data we used 3 for the analysis because they have the most data entries and would give a more accurate representation. The datasets used:  
* dailyActivity_merged.csv    
* dailyCalories_merged.csv    
* SleepDay_merged.csv  
* hourlyIntensities_merged.csv  
* hourlySteps_merged.csv

**Where is the data stored?**
The dataset used for this case study is the Fitbit fitness tracker data stored in Kaggle and available through Morbius  

**How is the data organized?**
There are 18 .csv files. The data within is structured in a rows and columns schema. The data is organized in a long format. This means that each row is a one-time point per subject. It contains values (customer ID numbers) that repeat in the first column.  

**Are there issues with bias or credibility in this data?**
The dataset was gathered from the personal data of about 30 participants who consented to the use of their data. There is sampling bias because it is quite a small sample size and it does not address all demographics, i.e age. The data is also outdated since it was collected in the year 2016.   

**How are you addressing licensing, privacy, security and accessibility?**
The data is CC0, a creative commons open-source license. It intends to cover all copyright and database rights. Data in the public domain are available to other users to reuse, enhance and build upon without copyright and database law restrictions. The participants of the survey from which the data was gathered also consented to the submission of personal tracker data. No personal data is contained in the data, hence privacy is maintained.

**How did you verify the data’s integrity?**
The data is stored on a verified source – Kaggle. It was generated by respondents to a distributed survey via Amazon Mechanical Turk, making it third-party data, which is considered unreliable. The data does not meet the requirements to be considered ROCCC (Reliable Original Comprehensive Current Cited).  

**Are there any problems with the data?**  
The data is outdated and does not reflex current trends.
There are several missing values

**Key tasks:**  
* Download data and store it appropriately  
* Identify how it is organized  
* Sort and filter the data  
* Determine the credibility of the data  

**Deliverables:**  
A description of all data sources used  


### Process  

**Tools**
I am using R for this analysis for its benefits of being a great tool for statistical analysis, accessibility, having good visualisation and can be reshared. The tool was used to transform, clean and visualise the data. 

**What steps have you taken to ensure that the data is clean?**   
I checked the data for errors, blanks, duplicates, extra spaces, and consistent formats in date, number, date-time, etc.   

The following are the steps taken in transforming, cleaning, and visualising the data.

Load the packages. They are already installed and up to date.
```{r}
#load packages

library(tidyverse)
library(lubridate)
library(ggplot2)
```

The .csv files were downloaded and uploaded to R studio. The read_csv() function was then used to read them. Of the 18 available files a few have been used because they have more samples compared to the ones not used. This decision was taken in order to have better results after difficulties in obtaining more data.
```{r}
#create data frames from .csv files

daily_activity <- read_csv("dailyActivity_merged.csv")
daily_calories <- read_csv("dailyCalories_merged.csv")
daily_sleep <- read_csv("sleepDay_merged.csv")
hourly_intensities <- read_csv("hourlyIntensities_merged.csv")
hourly_steps <- read_csv("hourlySteps_merged.csv")
```
**To view the data summary and structure.**    

We view tibbles containing summaries of the data and also the data structure of each data frame. This gives an idea of the columns, the data types and the kinds of trends that can be found in the data.
```{r}
#summaries of some of the data frames created

head(daily_activity)
str(daily_activity)

head(daily_calories)
str(daily_calories)

head(daily_sleep)
str(daily_sleep)
```
An inconsistency noticed in the daily_activity data frame makes the team want to know how often users have their watches on. From the difference in time it can be assumed that those users do not use their devices all day. More data needed.
```{r}
 
daily_activity$minutes_total <- daily_activity$VeryActiveMinutes + daily_activity$FairlyActiveMinutes + daily_activity$LightlyActiveMinutes + daily_activity$SedentaryMinutes        #Sum of total minutes as seen in the data. It helps compare active minutes to the number of minutes in a day - 1440 minutes.

sum(daily_activity$minutes_total > 1440)   #Tells us how many users are active all day
sum(daily_activity$minutes_total < 1440)   #Tells how many users are not active all day
```
Another inconsistency is noticed in the daily activity data frame. Some users have 0 total steps recorded and zero calories burned. If more data cannot be gathered to fill the gap it will be neglected.


**Cleaning**  

Confirming the number of unique ids in the data. The sample below confirms there are 33 unique Ids. Like with the daily_sleep data frame, some others had insufficient data due to a lack of entry. For that reason, they were neglected.
```{r}
n_distinct(daily_activity$Id)
n_distinct(daily_calories$Id)
n_distinct(daily_sleep$Id)
```
**Missing values**  

Checking for missing values. The data frames being used are complete and do not contain any missing values.
```{r}
sum(is.na(daily_activity))
sum(is.na(daily_calories))
sum(is.na(daily_sleep))

```
**Duplicates**  

To find duplicates in each data frame
```{r}
sum(duplicated(daily_activity))
sum(duplicated(daily_calories))
sum(duplicated(daily_sleep))
```
Removing dublicates
```{r}
daily_sleep <- daily_sleep %>% 
  distinct() %>% 
  drop_na()
```
Checking removal of duplicates in the daily_sleep data frame

```{r}
sum(duplicated(daily_sleep))
```
**Renaming columns**  

The column names of the data frames used were renamed for consistency, putting them all in lower case.
```{r}
#Created new data frames that have the columns in lower case

daily_activity_df <- rename_with(daily_activity, tolower)
colnames(daily_activity_df)

daily_calories_df <- rename_with(daily_calories, tolower)
colnames(daily_calories_df)

daily_sleep_df <- rename_with(daily_sleep, tolower)
colnames(daily_sleep_df)
hourly_steps_df <- rename_with(hourly_steps, tolower)
```
**Data formats**  

The sleepday column is of date-time format. It was converted to ensure that all formats are consistent.

```{r}
#The Rename() function changes the names of variables using new_name = old_name syntax
#The mutate() function is used to change date/ date-time formats here

daily_activity_df <- daily_activity_df %>%
  rename("date" = "activitydate") %>%
  mutate(date = as_date(date, format = "%m/%d/%Y"))

daily_sleep_df <- daily_sleep_df %>%
  rename("date" = "sleepday") %>%
  mutate(date = as_date(date,format ="%m/%d/%Y %I:%M:%S %p"))

hourly_steps_df <- hourly_steps_df %>%
  rename("date_time" = "activityhour") %>%
  mutate(date_time = as.POSIXct(date_time,format ="%m/%d/%Y %I:%M:%S %p" , tz=Sys.timezone()))

```

Summary of the updated data frames

```{r}
head(daily_activity_df)
head(daily_sleep_df)
head(hourly_steps_df)
```

**Data frames merged**   

The daily activity data frame contains data found in the daily calories data frame. We merged the daily activity data frame and the daily sleep data frame by date.
```{r}
#Merged daily_activity_df and daily_sleep_df into a new data frame using id and date vectors

daily_activity_sleep_df <- merge(daily_activity_df, daily_sleep_df, by = c ("id", "date"))
glimpse(daily_activity_sleep_df)
```



  
### Analyse  


**Key tasks**  

* Aggregate your data so it’s useful and accessible.  
* Organize and format your data.  
* Perform calculations.  
* Identify trends and relationships  

**Deliverable**  
A summary of the analysis


In this phase, the analysis will reveal a trend in the FitBit user data being worked with. This will establish how helpful the data is in coming up with a marketing strategy for our company. 

**Assumption**  
In the absence of a demographic we decided to gather additional data. This leads to a decision to categorise users based on steps taken per day. The categories according to the [link](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5488109/) :  

* <5000	Sedentary lifestyle  
* 5000–7499	Physically inactive  
* 7500–9999	Moderately active  
* ≥10,000	Physically active  
* ≥12,500	Very active    

This was used to calculate the average daily steps for each user
```{r}
#A summary of averages from the daily_activity_sleep_df grouped by id. 
#Used pipes to link the sequence of the analysis steps, taking the output of one function and passing it into another function as an argument.   

average_steps <- daily_activity_sleep_df %>%
  group_by(id) %>%
  summarise(avg_daily_steps = mean(totalsteps), avg_daily_calories = mean(calories), avg_daily_sleep = mean(totalminutesasleep))

head(average_steps)
```
Classification based on information stated above using average daily steps
```{r}
#The case_when() lets us print an output value if a condition is met. The conditions here are based on average daily steps taken by each user.
#The data frame is mutated to include a user_lifestlye variable showing each user's lifestyle based on their average daily steps

user_lifestyle <- average_steps %>%
  mutate(user_lifestyle = case_when(
    avg_daily_steps < 5000 ~ "sedentary lifestyle",
    avg_daily_steps >= 5000 & avg_daily_steps < 7499 ~ "physically inactive", 
    avg_daily_steps >= 7500 & avg_daily_steps < 9999 ~ "moderately active", 
    avg_daily_steps >= 10000 & avg_daily_steps< 12500~ "physically active",
    avg_daily_steps >= 12500 ~ "very active"
  ))

head(user_lifestyle)
```

***What percentage of people are living each lifestyle?***
Knowing this will let me create a clear visual representation.

```{r}
percentage_by_lifestyle <- user_lifestyle %>%    #new data frame
  group_by(user_lifestyle) %>%
  summarise(total = n()) %>%    #aggregate the number of occurrences 
  mutate(totals = sum(total)) %>%
  group_by(user_lifestyle) %>%
  summarise(total_percent = total / totals) %>%       #total percentage calculation
  mutate(labels = scales::percent(total_percent))

percentage_by_lifestyle$user_lifestyle <- factor(percentage_by_lifestyle$user_lifestyle , levels = c("very active", "physically active", "moderately active", "physically inactive", "sedentary lifestyle"))                    #The factor function takes a vector of values (numeric or character). In this case it is the life style of users (character)


head(percentage_by_lifestyle)
```

**Time of day most active**
Knowing what time of day users are more active will help the analysis process.
```{r}
hourly_steps_df <- hourly_steps_df %>%
  separate(date_time, into = c("date", "time"), sep= " ") %>%
  mutate(date = ymd(date)) 
  
head(hourly_steps_df)
```

***How are users using their devices?***   

A calculation of the days users used their devices lead the team to create a category by usage. This trend will be helpful in coming up with a marketing strategy for Bellabeat. 
It shows that a rather high percentage of users (38%) are not using their devices frequently. 50% of users use them frequently and 12% use them moderately.

```{r}
#Create categories based on device usage

quantified_usage <- daily_activity_sleep_df %>%
  group_by(id) %>%
  summarize(days_used=sum(n())) %>%
  mutate(usage = case_when(
    days_used >= 1 & days_used <= 10 ~ "infrequent use",
    days_used >= 11 & days_used <= 20 ~ "moderate use", 
    days_used >= 21 & days_used <= 31 ~ "frequent use", 
  ))
glimpse(quantified_usage)


#To find what percentage of users are in each category
percentage_by_usage <- quantified_usage %>%
  group_by(usage) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(usage) %>%
  summarise(total_percent = total / totals) %>%
  mutate(labels = scales::percent(total_percent))

percentage_by_usage$usage <- factor(percentage_by_usage$usage, levels = c("frequent use", "moderate use", "infrequent use"))

head(percentage_by_usage)
```

**Device usage**  

It is important to know how often the users have their devices on their person. 
```{r}
#Merged daily_activity_df and quantified_usage into a new daily_usage data frame

daily_usage <- merge(daily_activity_df, quantified_usage, by=c ("id"))
head(daily_usage)



#Used the daily_usage data frame to calculate the total minutes users wore their devices daily for
#The minutes_total variable created earlier is used here

mins_worn <- daily_usage %>% 
  mutate(minutes_total = veryactiveminutes+fairlyactiveminutes+lightlyactiveminutes+sedentaryminutes) %>%
  mutate (percent_mins_worn = (minutes_total/1440)*100) %>%
  mutate (worn = case_when(
    percent_mins_worn == 100 ~ "All day",
    percent_mins_worn < 100 & percent_mins_worn >= 50~ "More than half day", 
    percent_mins_worn < 50 & percent_mins_worn > 0 ~ "Less than half day"
  ))

head(mins_worn)

```
Further analysis of minutes users wear their devices for
```{r}
#percentage of device usage by category
percentage_mins_worn <- mins_worn %>%
  group_by(worn) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(worn) %>%
  summarise(percent_total = total / totals) %>%
  mutate(labels = scales::percent(percent_total))
head(percentage_mins_worn)


#What percentage of the high_use category users wear their devices often
high_use_mins <- mins_worn %>%
  filter(usage == "frequent use")%>%
  group_by(worn) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(worn) %>%
  summarise(percent_total = total / totals) %>%
  mutate(labels = scales::percent(percent_total))
head(high_use_mins)


#What percentage of the mid_use category users wear their devices often?
mid_use_mins <- mins_worn %>%
  filter(usage == "moderate use") %>%
  group_by(worn) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(worn) %>%
  summarise(percent_total = total / totals) %>%
  mutate(labels = scales::percent(percent_total))
head(mid_use_mins)


#What percentage of the low_use category users wear their devices often?
low_use_mins <- mins_worn%>%
  filter (usage == "infrequent use") %>%
  group_by(worn) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(worn) %>%
  summarise(percent_total = total / totals) %>%
  mutate(labels = scales::percent(percent_total))
head(low_use_mins)
```
**What days are users more active and what days are they getting the most sleep**  

Knowing which days users are least and most active can help us come up with a solution. A sleep pattern will also present great insight.
Analysis reveals high active minutes. It also reveals a low amount of sleep by users.
```{r}
weekday_active_sleep <- daily_activity_sleep_df %>%
  mutate(weekday = weekdays(date))

weekday_active_sleep$weekday <- ordered(weekday_active_sleep$weekday, levels=c("Monday", "Tuesday", "Wednesday", "Thursday",
"Friday", "Saturday", "Sunday"))

 weekday_active_sleep <-weekday_active_sleep %>%
  group_by(weekday) %>%
  summarize (daily_active_mins = mean(minutes_total), daily_sleep = mean(totalminutesasleep/60))

head(weekday_active_sleep)
```






### Share  

**Visualisation**

Visualisations give a better interpretation. This is the best and most effective way to convey findings from an analysis to shareholders.    

**Key tasks**  
* Determine the best way to share your findings.  
* Create effective data visualizations.  
* Present your findings.  
* Ensure your work is accessible.  

**Deliverable**  
Supporting visualizations and key findings  


The chart reveals that a total amount of users (58.4%) are quite active - 4.2% very active, 16.7 physically active, and 37.5 moderately active. A combined 41.6% are not too active - 20.8% both sedentary lifestyle and physically inactive
```{r}
#Colour palette codes tested for the chart - #218C8D #6CCECB #F9E559 #EF7126 #8EDC9D #473E3F #473E3F #E64A45 #DDDDDD #FF0080

mycols4 <- c("#DDDDDD", "#FF0080", "#F9E559", "#EF7126", "#8EDC9D")   #My combination

percentage_by_lifestyle %>% 
  ggplot(aes(x = "", y = total_percent, fill = user_lifestyle)) + 
  geom_bar(width = 1, stat = "identity", colour = "black") +
  coord_polar("y", start = 0) +
  geom_text(aes(label = labels), position = position_stack(vjust = 0.5)) +
  labs(title = "Distribution by User Lifestyle") +
  scale_fill_manual(values = mycols4) + 
  theme_void()
```

**Correlation**  

Established a correlation between daily steps and calories burned. The chart revealed that the most calories are burned on average by users taking more steps.
```{r}
ggplot(data = daily_activity_sleep_df) + 
  geom_point(mapping = aes(x = totalsteps, y = calories)) +
  geom_jitter(mapping = aes(x = totalsteps, y = calories)) +
  geom_smooth(mapping = aes(x = totalsteps, y = calories)) +
  labs(title = "Daily steps vs Calories Burned", x = "total daily steps", y= "calories") +
  annotate("text", x = 16000, y = 500, label = "positive correlation", colour = "black")
```

**Period of steps**

Viz for hourly steps per user. The result shows that a lot of steps are taken by the users during midday and/ or evenings.
```{r}

hourly_steps_df %>%
  group_by(time) %>%
  summarize(avg_steps = mean(steptotal)) %>%
  ggplot() +
  geom_col(mapping = aes(x=time, y = avg_steps, fill = avg_steps)) + 
  labs(title = "Hourly Steps During the Day", x="", y="") + 
  scale_fill_gradient(low = "green", high = "#41924B") +
  theme(axis.text.x = element_text(angle = 90))
```

**Total active minutes vs calories**  

Some users have more active minutes than others from the summation of the 'veryactiveminutes', 'fairlyactiveminutes', 'lightlyactiveminutes', and 'sedentaryminutes' attributes. Using the sum of these minutes, it was determined that there is some correlation between the total daily active minutes and the calories burned.
```{r}
#Viz of the total active minutes vs calories burned
ggplot(data = daily_activity, mapping = aes(x = minutes_total, y = Calories)) + 
  geom_point() +
  ggtitle("Daily Activite minutes VS. Calories burned") +
  geom_smooth()
```

**Frequency of device usage and percentage**  

During the survey period what percentage of users used their devices daily
```{r}
#Colour options #CCFFFF #00CC00 #FFCC00 #FF0000 #5F021F

percentage_by_usage %>%
  ggplot(aes(x="",y=total_percent, fill=usage)) +
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start=0)+
  theme_classic()+
  theme(axis.title.x= element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid = element_blank(), 
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size=14, face = "bold")) +
  geom_text(aes(label = labels),
            position = position_stack(vjust = 0.5))+
  scale_fill_manual(values = c("#3399FF","#FFCC00","#FF0000"),
                    labels = c("frequent use - 21 to 31 days",
                                 "moderate use - 11 to 20 days",
                                 "infrequent use - 1 to 10 days"))+
  labs(title="Daily Usage of Devices")

```

**Duration worn daily**  

From the analysis of minutes worn daily
```{r}

  ggplot(percentage_mins_worn, aes(x = "",y=percent_total, fill = worn)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y", start = 0) +
  theme_classic() +
  theme(axis.title.x= element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid = element_blank(), 
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size=14, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5)) +
    scale_fill_manual(values = c("#732C7B", "#EFD9DC", "#9C8AA5")) +
  geom_text(aes(label = labels),
            position = position_stack(vjust = 0.5), size = 3.5) +
  labs(title="Duration Worn Daily", subtitle = "Duration for which users wore devices")
```

**Most active days by total active minutes**  

According to the graph, users maintain high active minutes, Tuesday and Friday being the highest.
Users appear to not be getting the recommended minutes of sleep according to the second chart. The recommended amount of sleep for an adult aged 18 - 60years is 7hours+ according to [link](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4434546/#:~:text=Current%20evidence%20supports%20the%20general,%2C%20medical%2C%20and%20environmental%20factors.). We do not have age data, but we assume that the users fall in this range. According to the same source,  Individual variation in sleep need is influenced by genetic, behavioral, medical, and environmental factors, which we do not have.
```{r}

ggplot(weekday_active_sleep) +
      geom_col(aes(weekday, daily_active_mins), fill = "#AAF200") +
      geom_hline(yintercept = 750) +     #This assumes a recommended total active minutes of the value displayed
      labs(title = "Daily Active Mins per Weekday", x= "", y = "") +
      theme(axis.text.x = element_text(angle = 45,vjust = 0.5, hjust = 1))


ggplot(weekday_active_sleep, aes(weekday, daily_sleep)) +
      geom_col(fill = "#FF8000") +
      geom_hline(yintercept = 8) +
      labs(title = "Hours of Sleep per Weekday", x= "", y = "") +
      theme(axis.text.x = element_text(angle = 45,vjust = 0.5, hjust = 1))

```



### Summary and Recommendation


**Summary**  

* The FitBit time piece serves a similar purpose as Bellabeat's Time and Leaf products. Thus, why we focused our analysis on its data.  

* The analysis revealed that while some users maintain an active life style, quite a lot maintain an inactive or sedentary lifestyle.

* The analysis revealed that a lot of steps are taken by noon (12pm-2pm) and evenings (6pm-7pm).  

* A correlations is revealed between the daily/ total steps and the amount of calories burned. It shows that higher calories are burned by those taking more steps.  

* A correlation is revealed between the daily active minutes and calories burned. It shows that more calories are burned by users with higher active minutes.  

* The analysis revealed that a high percentage of users (38%) did not use their devices frequently. A high percentage (62% combined) used their devices moderately and frequently.  

* The analysis revealed that a good amount of users have their devices on for at least half a day.  

* It is revealed that users are not getting enough sleep daily. Only one day of the week records a sufficient average of sleep hours.



**Recommendation**  

* We have the Bellabeat Time and Leaf products, which track sleep and other vital data. A feature that lets users set a bedtime and a wake-up time will help them meet the recommended sleep hours. We should also consider doing a weekly summary of sleep hours to help our users adjust according to their needs.

* We should convince the users to wear and use their devices more often. We can lay emphasis on the kinds of data they can keep track of in all environments (dry or wet). Emphases on the privacy of their data can encourage them.  

* Daily reminders to take steps, exercise, sleep, etc. can help our users to be mindful of their activities. Helpful articles or short videos on the importance of these things could be of great benefit.  
We want to keep users active. We can collect data from the users on why if for any reason they do not walk, stay active, or sleep enough, and come up with suggestions and help based on their responses. They do pay a fine subscription after all hahaha  

* The data analysed did not reveal gender-specific information. Our business focuses on the wellness of women. I suggest we use specific data we have collected in this regard for a more accurate analysis.  


***Thank you***
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```